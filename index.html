<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Finance Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
  <style id="app-style">
    :root {
      --primary-color: #3b82f6;
      --secondary-color: #6366f1;
      --success-color: #10b981;
      --danger-color: #ef4444;
      --warning-color: #f59e0b;
      --info-color: #6b7280;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
    }

    .card {
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      background-color: #fff;
      transition: all 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .btn {
      @apply px-4 py-2 rounded-lg font-medium transition-all duration-200;
    }

    .btn-primary {
      @apply bg-blue-500 text-white hover:bg-blue-600;
    }

    .btn-danger {
      @apply bg-red-500 text-white hover:bg-red-600;
    }

    .btn-outline {
      @apply border border-gray-300 hover:bg-gray-100;
    }

    .expense-item {
      transition: all 0.2s ease;
    }

    .expense-item:hover {
      background-color: #f3f4f6;
    }

    .category-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    input[type="color"] {
      -webkit-appearance: none;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    
    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 50%;
    }

    .mobile-nav {
      display: none;
    }

    @media (max-width: 768px) {
      .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: white;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      
      .content-area {
        padding-bottom: 80px; /* Make space for mobile nav */
      }
    }

    .settings-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100%;
      background: white;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transition: right 0.3s ease;
    }

    .settings-panel.open {
      right: 0;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }

    .overlay.active {
      display: block;
    }

    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: var(--primary-color);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body class="text-gray-800">
  <!-- Top Bar -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center">
        <i class="fas fa-wallet text-blue-500 text-2xl mr-3"></i>
        <h1 class="text-xl font-bold text-gray-800">Finance Tracker</h1>
      </div>
      <button id="settings-btn" class="text-gray-600 hover:text-gray-800 focus:outline-none">
        <i class="fas fa-cog text-xl"></i>
      </button>
    </div>
  </header>

  <div class="content-area container mx-auto px-4 py-6">
    <!-- Dashboard Section -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Total Spending Card -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold text-gray-500 mb-2">Total Spending</h3>
          <div class="flex items-end">
            <p class="text-3xl font-bold" id="total-spending">₹0.00</p>
            <span class="text-sm text-gray-500 ml-2 mb-1">to date</span>
          </div>
        </div>

        <!-- This Month's Spending Card -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold text-gray-500 mb-2">This Month</h3>
          <div class="flex items-end">
            <p class="text-3xl font-bold" id="month-spending">₹0.00</p>
            <span class="text-sm text-gray-500 ml-2 mb-1" id="month-name"></span>
          </div>
        </div>

        <!-- Average Daily Spending Card -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold text-gray-500 mb-2">Daily Average</h3>
          <div class="flex items-end">
            <p class="text-3xl font-bold" id="daily-average">₹0.00</p>
            <span class="text-sm text-gray-500 ml-2 mb-1">per day</span>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <!-- Spending by Category -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4">Spending by Category</h3>
          <div class="aspect-square">
            <canvas id="category-chart"></canvas>
          </div>
        </div>

        <!-- Add Expense Form -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4">Add Expense</h3>
          <form id="expense-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="text-gray-500">₹</span>
                </div>
                <input type="number" id="expense-amount" step="0.01" min="0" required 
                  class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="0.00">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
              <input type="date" id="expense-date" required 
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
              <select id="expense-category" required
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Select a category</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Description (optional)</label>
              <input type="text" id="expense-description" 
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="What was this expense for?">
            </div>
            
            <button type="submit" class="w-full btn btn-primary">
              <i class="fas fa-plus mr-2"></i> Add Expense
            </button>
          </form>
        </div>
      </div>
    </section>

    <!-- Recent Expenses Section -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-6">Recent Expenses</h2>
      
      <div class="card overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody id="expenses-table-body" class="bg-white divide-y divide-gray-200">
              <tr class="text-center">
                <td colspan="5" class="py-10 text-gray-500">No expenses recorded yet</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Charts Section -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-6">Spending Trends</h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Spending Over Time Chart -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4">Spending Over Time</h3>
          <div class="aspect-video">
            <canvas id="time-chart"></canvas>
          </div>
        </div>

        <!-- Monthly Totals Chart -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4">Monthly Totals</h3>
          <div class="aspect-video">
            <canvas id="monthly-chart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Categories Management Section -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold mb-6">Manage Categories</h2>
      
      <div class="card p-6">
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Categories List -->
          <div class="w-full md:w-2/3">
            <h3 class="text-lg font-semibold mb-4">Your Categories</h3>
            <div id="categories-container" class="space-y-2">
              <!-- Categories will be added here dynamically -->
            </div>
          </div>

          <!-- Add Category Form -->
          <div class="w-full md:w-1/3">
            <h3 class="text-lg font-semibold mb-4">Add New Category</h3>
            <form id="category-form" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category Name</label>
                <input type="text" id="category-name" required 
                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="New Category">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                <input type="color" id="category-color" value="#3b82f6">
              </div>
              
              <button type="submit" class="w-full btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Add Category
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settings-panel">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Settings</h2>
        <button id="close-settings" class="text-gray-500 hover:text-gray-700 focus:outline-none">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>

      <div class="space-y-6">
        <div>
          <h3 class="text-lg font-semibold mb-3">Reminders</h3>
          <div class="space-y-2">
            <label class="flex items-center space-x-3">
              <input type="radio" name="reminder-frequency" value="off" checked
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span>Off</span>
            </label>
            
            <label class="flex items-center space-x-3">
              <input type="radio" name="reminder-frequency" value="daily"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span>Daily Reminder</span>
            </label>
            
            <label class="flex items-center space-x-3">
              <input type="radio" name="reminder-frequency" value="weekly"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span>Weekly Reminder</span>
            </label>
          </div>
        </div>

        <div class="pt-4 border-t border-gray-200">
          <h3 class="text-lg font-semibold mb-3 text-red-600">Danger Zone</h3>
          <button id="clear-data-btn" class="btn btn-danger">
            <i class="fas fa-trash mr-2"></i> Start Over (Clear All Data)
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <a href="javascript:void(0)" class="flex-1 py-3 flex flex-col items-center text-gray-600 hover:text-blue-500 active-tab" data-tab="dashboard">
      <i class="fas fa-chart-pie text-lg"></i>
      <span class="text-xs mt-1">Dashboard</span>
    </a>
    <a href="javascript:void(0)" class="flex-1 py-3 flex flex-col items-center text-gray-600 hover:text-blue-500" data-tab="add-expense">
      <i class="fas fa-plus-circle text-lg"></i>
      <span class="text-xs mt-1">Add Expense</span>
    </a>
    <a href="javascript:void(0)" class="flex-1 py-3 flex flex-col items-center text-gray-600 hover:text-blue-500" data-tab="charts">
      <i class="fas fa-chart-line text-lg"></i>
      <span class="text-xs mt-1">Charts</span>
    </a>
    <a href="javascript:void(0)" class="flex-1 py-3 flex flex-col items-center text-gray-600 hover:text-blue-500" data-tab="settings">
      <i class="fas fa-cog text-lg"></i>
      <span class="text-xs mt-1">Settings</span>
    </a>
  </nav>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="fixed inset-0 flex items-center justify-center z-[1001] hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>
    <div class="bg-white rounded-lg shadow-lg p-6 z-10 w-full max-w-md mx-4">
      <h3 class="text-xl font-bold mb-4">Confirm Delete</h3>
      <p class="text-gray-600 mb-6">Are you sure you want to delete all your data? This action cannot be undone.</p>
      <div class="flex justify-end space-x-3">
        <button id="cancel-delete" class="btn btn-outline">Cancel</button>
        <button id="confirm-delete" class="btn btn-danger">Delete All Data</button>
      </div>
    </div>
  </div>

  <script id="app-script">
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the application
      const DateTime = luxon.DateTime;
      let categoryChart, timeChart, monthlyChart;

      // Set today's date as the default for the expense form
      document.getElementById('expense-date').valueAsDate = new Date();
      
      // Display current month name
      const currentMonth = DateTime.now().toFormat('MMMM yyyy');
      document.getElementById('month-name').textContent = currentMonth;

      // Initialize Local Storage
      function initializeLocalStorage() {
        // Initialize expenses if not exists
        if (!localStorage.getItem('expenses')) {
          localStorage.setItem('expenses', JSON.stringify([]));
        }

        // Initialize default categories if not exists
        if (!localStorage.getItem('categories')) {
          const defaultCategories = [
            { id: 'food', name: 'Food & Dining', color: '#10b981', isDefault: true },
            { id: 'groceries', name: 'Groceries', color: '#f59e0b', isDefault: true },
            { id: 'transport', name: 'Transportation', color: '#3b82f6', isDefault: true },
            { id: 'utilities', name: 'Utilities', color: '#8b5cf6', isDefault: true },
            { id: 'entertainment', name: 'Entertainment', color: '#ec4899', isDefault: true },
            { id: 'shopping', name: 'Shopping', color: '#6366f1', isDefault: true },
            { id: 'health', name: 'Health', color: '#ef4444', isDefault: true },
            { id: 'education', name: 'Education', color: '#14b8a6', isDefault: true },
            { id: 'other', name: 'Other', color: '#6b7280', isDefault: true }
          ];
          localStorage.setItem('categories', JSON.stringify(defaultCategories));
        }

        // Initialize settings if not exists
        if (!localStorage.getItem('settings')) {
          const defaultSettings = {
            reminderFrequency: 'off'
          };
          localStorage.setItem('settings', JSON.stringify(defaultSettings));
        }
      }

      // Format currency
      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-IN', {
          style: 'currency',
          currency: 'INR'
        }).format(amount);
      }

      // Load categories from LocalStorage
      function loadCategories() {
        const categories = JSON.parse(localStorage.getItem('categories')) || [];
        return categories;
      }

      // Load expenses from LocalStorage
      function loadExpenses() {
        const expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        return expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      // Update the categories dropdown
      function updateCategoriesDropdown() {
        const categories = loadCategories();
        const dropdown = document.getElementById('expense-category');
        
        // Clear dropdown
        dropdown.innerHTML = '<option value="">Select a category</option>';
        
        // Add categories to dropdown
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category.id;
          option.textContent = category.name;
          option.style.backgroundColor = category.color + '20'; // Light version of the color
          dropdown.appendChild(option);
        });
      }

      // Update categories list in the management section
      function updateCategoriesList() {
        const categories = loadCategories();
        const container = document.getElementById('categories-container');
        container.innerHTML = '';

        categories.forEach(category => {
          const categoryElement = document.createElement('div');
          categoryElement.className = 'flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg';
          
          // Category dot and name
          const categoryInfo = document.createElement('div');
          categoryInfo.className = 'flex items-center';
          categoryInfo.innerHTML = `
            <span class="category-dot mr-3" style="background-color: ${category.color}"></span>
            <span>${category.name}</span>
          `;
          
          // Delete button (only for custom categories)
          const actions = document.createElement('div');
          if (!category.isDefault) {
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'text-red-500 hover:text-red-700 focus:outline-none';
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
            deleteBtn.addEventListener('click', () => deleteCategory(category.id));
            actions.appendChild(deleteBtn);
          }

          categoryElement.appendChild(categoryInfo);
          categoryElement.appendChild(actions);
          container.appendChild(categoryElement);
        });
      }

      // Delete a category
      function deleteCategory(categoryId) {
        const categories = loadCategories();
        const expenses = loadExpenses();

        // Find expenses using this category and reassign them to "Other"
        expenses.forEach(expense => {
          if (expense.category === categoryId) {
            expense.category = 'other';
          }
        });

        // Remove category
        const updatedCategories = categories.filter(cat => cat.id !== categoryId);
        
        // Update localStorage
        localStorage.setItem('categories', JSON.stringify(updatedCategories));
        localStorage.setItem('expenses', JSON.stringify(expenses));
        
        // Refresh UI
        updateCategoriesList();
        updateCategoriesDropdown();
        updateExpensesList();
        updateDashboard();
        updateCharts();
      }

      // Add a new category
      function addCategory(event) {
        event.preventDefault();
        
        const nameInput = document.getElementById('category-name');
        const colorInput = document.getElementById('category-color');
        
        const name = nameInput.value.trim();
        const color = colorInput.value;
        
        if (!name) {
          alert('Please enter a category name');
          return;
        }
        
        const categories = loadCategories();
        const id = name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now().toString(36);
        
        // Add new category
        categories.push({
          id: id,
          name: name,
          color: color,
          isDefault: false
        });
        
        // Update localStorage
        localStorage.setItem('categories', JSON.stringify(categories));
        
        // Reset form
        nameInput.value = '';
        colorInput.value = '#3b82f6';
        
        // Refresh UI
        updateCategoriesList();
        updateCategoriesDropdown();
      }

      // Add a new expense
      function addExpense(event) {
        event.preventDefault();
        
        const amountInput = document.getElementById('expense-amount');
        const dateInput = document.getElementById('expense-date');
        const categoryInput = document.getElementById('expense-category');
        const descriptionInput = document.getElementById('expense-description');
        
        const amount = parseFloat(amountInput.value);
        const date = dateInput.value;
        const category = categoryInput.value;
        const description = descriptionInput.value.trim();
        
        if (!amount || isNaN(amount) || amount <= 0) {
          alert('Please enter a valid amount');
          return;
        }
        
        if (!date) {
          alert('Please select a date');
          return;
        }
        
        if (!category) {
          alert('Please select a category');
          return;
        }
        
        const expenses = loadExpenses();
        
        // Add new expense
        expenses.push({
          id: Date.now().toString(),
          amount: amount,
          date: date,
          category: category,
          description: description
        });
        
        // Sort by date (newest first)
        expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Update localStorage
        localStorage.setItem('expenses', JSON.stringify(expenses));
        
        // Reset form
        amountInput.value = '';
        dateInput.valueAsDate = new Date();
        categoryInput.value = '';
        descriptionInput.value = '';
        
        // Refresh UI
        updateExpensesList();
        updateDashboard();
        updateCharts();
      }

      // Delete an expense
      function deleteExpense(expenseId) {
        const expenses = loadExpenses();
        const updatedExpenses = expenses.filter(exp => exp.id !== expenseId);
        
        // Update localStorage
        localStorage.setItem('expenses', JSON.stringify(updatedExpenses));
        
        // Refresh UI
        updateExpensesList();
        updateDashboard();
        updateCharts();
      }

      // Update the expenses list table
      function updateExpensesList() {
        const expenses = loadExpenses();
        const categories = loadCategories();
        const tableBody = document.getElementById('expenses-table-body');
        
        // Clear table
        tableBody.innerHTML = '';
        
        if (expenses.length === 0) {
          tableBody.innerHTML = `
            <tr class="text-center">
              <td colspan="5" class="py-10 text-gray-500">No expenses recorded yet</td>
            </tr>
          `;
          return;
        }
        
        // Add expenses to table
        expenses.forEach(expense => {
          const category = categories.find(cat => cat.id === expense.category) || { name: 'Unknown', color: '#6b7280' };
          const formattedDate = DateTime.fromISO(expense.date).toFormat('MMM d, yyyy');
          const formattedAmount = formatCurrency(expense.amount);
          
          const row = document.createElement('tr');
          row.className = 'expense-item hover:bg-gray-50';
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
              ${formattedDate}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <span class="category-dot mr-2" style="background-color: ${category.color}"></span>
                <span>${category.name}</span>
              </div>
            </td>
            <td class="px-6 py-4">
              ${expense.description || '-'}
            </td>
            <td class="px-6 py-4 text-right font-medium">
              ${formattedAmount}
            </td>
            <td class="px-6 py-4 text-right">
              <button class="text-red-500 hover:text-red-700 focus:outline-none delete-expense" data-id="${expense.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          
          tableBody.appendChild(row);
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-expense').forEach(button => {
          button.addEventListener('click', function() {
            const expenseId = this.getAttribute('data-id');
            deleteExpense(expenseId);
          });
        });
      }

      // Update dashboard summary
      function updateDashboard() {
        const expenses = loadExpenses();
        
        // Calculate total spending
        const totalSpending = expenses.reduce((total, expense) => total + expense.amount, 0);
        document.getElementById('total-spending').textContent = formatCurrency(totalSpending);
        
        // Calculate this month's spending
        const now = DateTime.now();
        const thisMonthStart = DateTime.now().startOf('month');
        const thisMonthEnd = DateTime.now().endOf('month');
        
        const thisMonthExpenses = expenses.filter(expense => {
          const expenseDate = DateTime.fromISO(expense.date);
          return expenseDate >= thisMonthStart && expenseDate <= thisMonthEnd;
        });
        
        const thisMonthSpending = thisMonthExpenses.reduce((total, expense) => total + expense.amount, 0);
        document.getElementById('month-spending').textContent = formatCurrency(thisMonthSpending);
        
        // Calculate daily average
        if (expenses.length > 0) {
          const dates = expenses.map(expense => DateTime.fromISO(expense.date));
          const minDate = DateTime.min(...dates);
          const daysDiff = Math.max(1, now.diff(minDate, 'days').days);
          const dailyAverage = totalSpending / daysDiff;
          document.getElementById('daily-average').textContent = formatCurrency(dailyAverage);
        } else {
          document.getElementById('daily-average').textContent = formatCurrency(0);
        }
      }

      // Update all charts
      function updateCharts() {
        const expenses = loadExpenses();
        const categories = loadCategories();
        
        // Skip if there are no expenses
        if (expenses.length === 0) {
          return;
        }

        // Prepare data for category chart
        const categoryData = {};
        categories.forEach(category => {
          categoryData[category.id] = 0;
        });
        
        expenses.forEach(expense => {
          if (categoryData[expense.category] !== undefined) {
            categoryData[expense.category] += expense.amount;
          } else {
            categoryData.other += expense.amount;
          }
        });
        
        const categoryChartData = {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: [],
            borderWidth: 1
          }]
        };
        
        for (const [id, total] of Object.entries(categoryData)) {
          if (total > 0) {
            const category = categories.find(cat => cat.id === id);
            if (category) {
              categoryChartData.labels.push(category.name);
              categoryChartData.datasets[0].data.push(total);
              categoryChartData.datasets[0].backgroundColor.push(category.color);
            }
          }
        }
        
        // Update or create category chart
        const categoryChartCanvas = document.getElementById('category-chart');
        if (categoryChart) {
          categoryChart.data = categoryChartData;
          categoryChart.update();
        } else {
          categoryChart = new Chart(categoryChartCanvas, {
            type: 'pie',
            data: categoryChartData,
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'right',
                  labels: {
                    boxWidth: 12,
                    padding: 20
                  }
                }
              }
            }
          });
        }
        
        // Prepare data for time chart (last 30 days)
        const today = DateTime.now();
        const thirtyDaysAgo = today.minus({ days: 30 });
        
        const dateRangeMap = {};
        for (let i = 0; i <= 30; i++) {
          const date = thirtyDaysAgo.plus({ days: i });
          const dateString = date.toISODate();
          dateRangeMap[dateString] = 0;
        }
        
        expenses.forEach(expense => {
          const expenseDate = DateTime.fromISO(expense.date);
          if (expenseDate >= thirtyDaysAgo && expenseDate <= today) {
            const dateString = expenseDate.toISODate();
            if (dateRangeMap[dateString] !== undefined) {
              dateRangeMap[dateString] += expense.amount;
            }
          }
        });
        
        const timeChartLabels = [];
        const timeChartData = [];
        
        for (const [date, amount] of Object.entries(dateRangeMap)) {
          timeChartLabels.push(DateTime.fromISO(date).toFormat('MMM d'));
          timeChartData.push(amount);
        }
        
        // Update or create time chart
        const timeChartCanvas = document.getElementById('time-chart');
        if (timeChart) {
          timeChart.data.labels = timeChartLabels;
          timeChart.data.datasets[0].data = timeChartData;
          timeChart.update();
        } else {
          timeChart = new Chart(timeChartCanvas, {
            type: 'line',
            data: {
              labels: timeChartLabels,
              datasets: [{
                label: 'Daily Spending',
                data: timeChartData,
                fill: false,
                borderColor: '#3b82f6',
                tension: 0.1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return '₹' + value;
                    }
                  }
                }
              }
            }
          });
        }
        
        // Prepare data for monthly chart (last 12 months)
        const monthlyData = {};
        const currentMonth = today.startOf('month');
        
        for (let i = 11; i >= 0; i--) {
          const month = currentMonth.minus({ months: i });
          const monthKey = month.toFormat('yyyy-MM');
          monthlyData[monthKey] = 0;
        }
        
        expenses.forEach(expense => {
          const expenseDate = DateTime.fromISO(expense.date);
          const monthKey = expenseDate.toFormat('yyyy-MM');
          
          if (monthlyData[monthKey] !== undefined) {
            monthlyData[monthKey] += expense.amount;
          }
        });
        
        const monthlyChartLabels = [];
        const monthlyChartData = [];
        
        for (const [month, amount] of Object.entries(monthlyData)) {
          monthlyChartLabels.push(DateTime.fromISO(month + '-01').toFormat('MMM yyyy'));
          monthlyChartData.push(amount);
        }
        
        // Update or create monthly chart
        const monthlyChartCanvas = document.getElementById('monthly-chart');
        if (monthlyChart) {
          monthlyChart.data.labels = monthlyChartLabels;
          monthlyChart.data.datasets[0].data = monthlyChartData;
          monthlyChart.update();
        } else {
          monthlyChart = new Chart(monthlyChartCanvas, {
            type: 'bar',
            data: {
              labels: monthlyChartLabels,
              datasets: [{
                label: 'Monthly Spending',
                data: monthlyChartData,
                backgroundColor: '#6366f1'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return '₹' + value;
                    }
                  }
                }
              }
            }
          });
        }
      }

      // Handle settings
      function updateSettings() {
        const settings = JSON.parse(localStorage.getItem('settings'));
        
        // Update reminder frequency radio buttons
        document.querySelector(`input[name="reminder-frequency"][value="${settings.reminderFrequency}"]`).checked = true;
        
        // Check if Notification API is available
        if ('Notification' in window) {
          if (settings.reminderFrequency !== 'off' && Notification.permission !== 'granted') {
            // Request permission for notifications
            Notification.requestPermission();
          }
        }
      }
      
      // Save settings
      function saveSettings() {
        const reminderFrequency = document.querySelector('input[name="reminder-frequency"]:checked').value;
        
        const settings = {
          reminderFrequency: reminderFrequency
        };
        
        localStorage.setItem('settings', JSON.stringify(settings));
        
        // Handle notifications setup/removal
        setupNotifications(reminderFrequency);
      }
      
      // Setup notifications based on frequency
      function setupNotifications(frequency) {
        // For this prototype, we'll just indicate that notifications would be set up
        console.log(`Notification reminders set to: ${frequency}`);
      }
      
      // Clear all data (reset app)
      function clearAllData() {
        localStorage.removeItem('expenses');
        localStorage.removeItem('categories');
        localStorage.removeItem('settings');
        
        // Re-initialize with defaults
        initializeLocalStorage();
        
        // Refresh UI
        updateCategoriesList();
        updateCategoriesDropdown();
        updateExpensesList();
        updateDashboard();
        updateCharts();
        updateSettings();
        
        // Close modal
        document.getElementById('delete-modal').classList.add('hidden');
        document.getElementById('overlay').classList.remove('active');
      }

      // Event Listeners
      document.getElementById('expense-form').addEventListener('submit', addExpense);
      document.getElementById('category-form').addEventListener('submit', addCategory);
      
      // Settings panel toggle
      document.getElementById('settings-btn').addEventListener('click', function() {
        document.getElementById('settings-panel').classList.add('open');
        document.getElementById('overlay').classList.add('active');
      });
      
      document.getElementById('close-settings').addEventListener('click', function() {
        document.getElementById('settings-panel').classList.remove('open');
        document.getElementById('overlay').classList.remove('active');
      });
      
      document.getElementById('overlay').addEventListener('click', function() {
        document.getElementById('settings-panel').classList.remove('open');
        document.getElementById('delete-modal').classList.add('hidden');
        this.classList.remove('active');
      });
      
      // Clear data
      document.getElementById('clear-data-btn').addEventListener('click', function() {
        document.getElementById('delete-modal').classList.remove('hidden');
        document.getElementById('overlay').classList.add('active');
      });
      
      document.getElementById('cancel-delete').addEventListener('click', function() {
        document.getElementById('delete-modal').classList.add('hidden');
        document.getElementById('overlay').classList.remove('active');
      });
      
      document.getElementById('confirm-delete').addEventListener('click', clearAllData);
      
      // Save settings when radio buttons change
      document.querySelectorAll('input[name="reminder-frequency"]').forEach(radio => {
        radio.addEventListener('change', saveSettings);
      });
      
      // Mobile navigation
      document.querySelectorAll('.mobile-nav a').forEach(tab => {
        tab.addEventListener('click', function() {
          // Remove active class from all tabs
          document.querySelectorAll('.mobile-nav a').forEach(t => t.classList.remove('text-blue-500'));
          // Add active class to clicked tab
          this.classList.add('text-blue-500');
          
          const tabName = this.getAttribute('data-tab');
          
          // Handle tab switching
          if (tabName === 'settings') {
            document.getElementById('settings-panel').classList.add('open');
            document.getElementById('overlay').classList.add('active');
          }
          
          // For a more complex app, we would show/hide sections based on tab
          // But for this prototype, we'll just scroll to the relevant section
          if (tabName === 'dashboard') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } else if (tabName === 'add-expense') {
            const form = document.getElementById('expense-form');
            form.scrollIntoView({ behavior: 'smooth' });
          } else if (tabName === 'charts') {
            const chartsSection = document.querySelector('section:nth-of-type(3)');
            chartsSection.scrollIntoView({ behavior: 'smooth' });
          }
        });
      });

      // Initialize the app
      initializeLocalStorage();
      updateCategoriesList();
      updateCategoriesDropdown();
      updateExpensesList();
      updateDashboard();
      updateCharts();
      updateSettings();
    });
  </script>
</body>
</html>